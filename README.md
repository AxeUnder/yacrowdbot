# Ð ÐµÐºÐ»Ð°Ð¼Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚-Ð±Ð¾Ñ‚ yacrowdbot

## ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ
Yacrowdbot Ñ‡Ð°Ñ‚-Ð±Ð¾Ñ‚ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ð»Ð°Ð³Ð°ÐµÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ñ€ÑƒÑ‚Ð¸Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐ¾Ð², Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐ¾ÐºÑ€Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ð¸ Ñ€ÐµÑÑƒÑ€ÑÑ‹, Ð·Ð°Ñ‚Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð½Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÑ‚Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡. Ð­Ñ‚Ð¾ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð² ÑÐµÐ±Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½ÑƒÑŽ Ñ€Ð°ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹, Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ñ€ÐµÐ°Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸ ÑÐ¾Ð²ÐµÑ€ÑˆÐµÐ½ÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸.

**Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¸ ÑÑ‚ÐµÐº:** #Python3.9 #python-telegram-bot #HTTPX #requests #asyncio #pytz #logging #dotenv #PyCharm (Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸)

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°
1. ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹:
    ```sh
    git clone https://github.com/axeunder/yacrowdbot.git
    cd yacrowdbot
    ```
2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:
    ```sh
    pip install -r requirements.txt
    ```
3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env` Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð²Ð°Ñˆ Ñ‚Ð¾ÐºÐµÐ½ Telegram API, Ð° Ñ‚Ð°ÐºÐ¶Ðµ URL API Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ:
    ```sh
    API_TOKEN=Ð²Ð°Ñˆ_Ñ‚Ð¾ÐºÐµÐ½_telegram_api
    JETADMIN_API_KEY=Ð²Ð°Ñˆ_Ñ‚Ð¾ÐºÐµÐ½_jet_aadmin_api
    API_URL_POST=Ð²Ð°Ñˆ_url_Ð´Ð»Ñ_api_Ð¿Ð¾Ñ‚Ð¾Ð²
    API_URL_USER=Ð²Ð°Ñˆ_url_Ð´Ð»Ñ_api_Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
    ```
4. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°:
    ```sh
    python yacrowdbot.py
    ```

## Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ
ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚ Ð½Ð°Ñ‡Ð½ÐµÑ‚ Ð¾Ð¿Ñ€Ð¾Ñ Telegram API Ð¸ Ð±ÑƒÐ´ÐµÑ‚ Ð³Ð¾Ñ‚Ð¾Ð² Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¸ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹. 

### ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
- `/start` - Ð·Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð° Ð¸ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ.
- `/help` - Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´.
- `/change_time` - ÑÐ¼ÐµÐ½Ð° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹.
- `/change_time_zone` - ÑÐ¼ÐµÐ½Ð° Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾ÑÑÐ°.
- `/keep_settings` - Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹.

## Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ
### ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ
Ð‘Ð¾Ñ‚ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `/start`. 

### Ð¡Ð¼ÐµÐ½Ð° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸
ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ñ€Ð°ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `/change_time`. Ð’Ñ€ÐµÐ¼Ñ Ð²Ð²Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ `Ñ‡Ñ‡:Ð¼Ð¼-Ñ‡Ñ‡:Ð¼Ð¼`.

### Ð¡Ð¼ÐµÐ½Ð° Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾ÑÑÐ°
Ð¡ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ `/change_time_zone` Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð¹ Ð¿Ð¾ÑÑ. Ð’Ð²Ð¾Ð´ Ð¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð»ÑÐµÑ‚ÑÑ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ `Â±Ñ‡Ñ‡:Ð¼Ð¼`.

### ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
Ð‘Ð¾Ñ‚ Ñ‚Ð°ÐºÐ¶Ðµ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÐµÑ‚ Ð½Ð° Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ.

### Ð Ð°ÑÑÑ‹Ð»ÐºÐ° Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹
Ð‘Ð¾Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð½Ð¾Ð²Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼ Ð² Ð·Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸. ÐÐ¾Ð²Ð¾ÑÑ‚Ð¸ Ð²ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ Ñ‚ÐµÐºÑÑ‚, Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð¸ Ð²Ð¸Ð´ÐµÐ¾.

### ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº
Ð‘Ð¾Ñ‚ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸, Ð²Ð¾Ð·Ð½Ð¸ÐºÐ°ÑŽÑ‰Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÑƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ.

## ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÐºÐ¾Ð´Ð°

```python
import asyncio
from datetime import datetime, timedelta
import logging
import requests
import pytz
import os

from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application, CommandHandler, MessageHandler, filters,
    ContextTypes, ConversationHandler, CallbackQueryHandler
)
from telegram.error import TelegramError
from telegram.request import HTTPXRequest

from api import get_user, update_user, store_user, get_posts, get_users
from config import API_TOKEN

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
logging.basicConfig(format='%(asctime)s-%(name)s-%(levelname)s-%(message)s',
                    level=logging.INFO)
logger = logging.getLogger(__name__)

# Ð¡Ð»Ð¾Ð²Ð°Ñ€ÑŒ Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ³Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾ÑÑ‚Ð° Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
last_sent_posts = {}

# ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¹ Ð´Ð»Ñ ConversationHandler
SET_TIME, SET_TIME_ZONE = range(2)

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ‚Ð°Ð¹Ð¼-Ð°ÑƒÑ‚Ð¾Ð² Ð¸ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð´Ð»Ñ HTTPXRequest
request = HTTPXRequest(
    connect_timeout=10.0,
    read_timeout=300.0,
    write_timeout=300.0,
    pool_timeout=5.0
)

DEFAULT_KEYBOARD = [
    [InlineKeyboardButton('ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ', callback_data='help')],
    [InlineKeyboardButton('Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼ÑâŒ›', callback_data='change_time')],
    [InlineKeyboardButton('Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ñ‡Ð°ÑÐ¾Ð²Ð¾Ð¹ Ð¿Ð¾ÑÑðŸŒ', callback_data='change_time_zone')]
]

KEYBOARD_CANCEL = [
    [InlineKeyboardButton('ÐžÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸', callback_data='keep_settings')]
]

async def say_hi(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ñ"""
    chat = update.effective_chat
    reply_markup = InlineKeyboardMarkup(DEFAULT_KEYBOARD)
    try:
        await context.bot.send_message(
            chat_id=chat.id,
            text='ÐŸÑ€Ð¸Ð²ÐµÑ‚, Ñ CrowdBot!',
            reply_markup=reply_markup
        )
    except Exception as e:
        logger.error(f'ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐµ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ {chat.id}: {e}')
```

# ÐžÐ± Ð°Ð²Ñ‚Ð¾Ñ€Ðµ
Python-Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº
> [AxeUnder](https://github.com/AxeUnder).
